# RabbitMQ + Machine Learning Pipeline

Данный проект представляет собой реализацию обработки данных и предсказаний с использованием RabbitMQ в качестве системы очередей. Проект состоит из нескольких скриптов, выполняющих различные задачи: отправка данных, обработка сообщений, предсказание результатов и визуализация ошибок.

---

## Содержание

1. [Структура проекта](#структура-проекта)
2. [Требования](#требования)
3. [Описание скриптов](#описание-скриптов)
    - [Скрипт 1: Отправка данных](#скрипт-1-отправка-данных)
    - [Скрипт 2: Логирование и обработка данных](#скрипт-2-логирование-и-обработка-данных)
    - [Скрипт 3: Предсказание](#скрипт-3-предсказание)
    - [Скрипт 4: Визуализация распределения ошибок](#скрипт-4-визуализация-распределения-ошибок)
4. [Как запустить](#как-запустить)
5. [Пример использования](#пример-использования)

---

## Структура проекта

```plaintext
├── docker-compose.yaml
├── features
│   └── src
│       ├── Dockerfile
│       ├── features.py
│       └── requirements.txt
├── logs
│   ├── error_distribution.png
│   └── metric_log.csv
├── metric
│   └── src
│       ├── Dockerfile
│       ├── metric.py
│       └── requirements.txt
├── model
│   └── src
│       ├── Dockerfile
│       ├── model.pkl
│       ├── model.py
│       └── requirements.txt
└── plot
    └── src
        ├── Dockerfile
        ├── plot.py
        └── requirements.txt
```

---

## Требования

- Docker и Docker Compose
- Python 3.8+
- RabbitMQ
- Установленные библиотеки (определены в `requirements.txt` каждого компонента):
  - `pika`
  - `numpy`
  - `scikit-learn`
  - `pandas`
  - `matplotlib`
  - `seaborn`

---

## Описание скриптов

### Скрипт 1: Отправка данных

**Файл:** `features/src/features.py`

Этот скрипт отправляет случайные данные из датасета `diabetes` в две очереди RabbitMQ: `y_true` (с истинными значениями) и `features` (с признаками).

- Генерирует уникальный `id` для каждого сообщения.
- Формирует случайный вектор признаков и соответствующее значение `y_true`.
- Публикует данные в очереди RabbitMQ с интервалом 10 секунд.

### Скрипт 2: Логирование и обработка данных

**Файл:** `metric/src/metric.py`

Этот скрипт обрабатывает сообщения из очередей `y_true` и `y_pred`, логирует данные и вычисляет абсолютную ошибку предсказания.

- Читает сообщения из RabbitMQ.
- Обновляет лог-файл `logs/metric_log.csv`.
- Вычисляет абсолютную ошибку и сохраняет её вместе с идентификатором сообщения.

### Скрипт 3: Предсказание

**Файл:** `model/src/model.py`

Скрипт читает вектор признаков из очереди `features`, выполняет предсказание с использованием загруженной модели `model.pkl` и отправляет результат в очередь `y_pred`.

- Загрузка модели из файла.
- Обработка сообщений из очереди `features`.
- Выполнение предсказания и отправка результата в RabbitMQ.

### Скрипт 4: Визуализация распределения ошибок

**Файл:** `plot/src/plot.py`

Этот скрипт строит и обновляет гистограмму распределения абсолютных ошибок предсказаний.

- Считывает лог-файл `logs/metric_log.csv`.
- Создаёт график распределения ошибок.
- Сохраняет график в файл `logs/error_distribution.png` каждые 10 секунд.

---

## Как запустить

1. Убедитесь, что Docker и Docker Compose установлены.
2. Запустите проект с помощью команды:

```bash
docker-compose up --build
```

3. Все сервисы начнут работать автоматически:
    - `features` для отправки данных.
    - `metric` для логирования и обработки данных.
    - `model` для предсказаний.
    - `plot` для визуализации.

---

## Пример использования

- После запуска всех сервисов в папке `logs` появятся файлы:
  - `metric_log.csv` — лог-файл с предсказаниями и ошибками.
  - `error_distribution.png` — гистограмма распределения абсолютных ошибок.
- Открывайте гистограмму для анализа качества модели.
